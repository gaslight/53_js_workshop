<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>JavaScript: The Good Parts</title>
    <script src="http://gnab.github.io/remark/downloads/remark-0.5.9.min.js" type="text/javascript"> </script>
    <style type="text/css" media="screen">
      @import url(http://fonts.googleapis.com/css?family=Droid+Serif);
      @import url(http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
        margin-top: 10px;
      }
      h1 { font-size: 3.5em; }
      h2 { font-size: 3em; }
      h3 { font-size: 1.6em; }
      .inverse {
        background: #272822;
        color: #777872;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }
      li {
        font-size: 1.5em;
      }
      pre {
        border-left: 0.4em solid #d7d7d7;
        padding: 1em !important;
      }
      code {
        background: transparent !important;
      }
      a {
        color: #F92672;
        text-decoration: none;
      }
      .task {
        float: right;
        font-size: 0.9em;
        padding-top: 0.6em;
      }
      .task a {
        color: #080;
        text-decoration: none;
      }
      .right {
        float: right;
        margin-left: 1em;
      }
      .pushdown {
        margin-top: 12em;
      }
      table.operators {
        margin-top: 20px;
        margin-left: 60px;
        border: 1px solid black;
        width: 500px;
        border-collapse: collapse;
      }
      table.operators td {
        border: 1px solid black;
        font-size: 1.2em;
        width: 250px;
      }
      table.operators td.header {
        font-weight: bold;
      }

    </style>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse

# Client-side web development

### Chris Nelson
### [Gaslight](http://gaslight.co)
### [@superchris](http://twitter.com/superchris)

---

# The Book

.right[![JavaScript: The Good Parts](thebook.png)]

Short, exclusively about JavaScript.

- "_Intended for programmers venturing into JavaScript for the first time_"

- "_... also indented for programmers who have been working with JavaScript at a novice level, and are now ready for a more sophisticated relationship with the language_"

- "_This is not a book for beginners_"

- "_This is not a book for dummies_"


???

- Crockford som har skrevet både bok og JSLint (luke ut ulumskheter)
- editorjs - online editor m/ oppgaver, kjøring og linting
- Fokus kun på språk, ikke rammeverk / arkitektur

---
class: center, middle

## Slides
### [http://gaslight.github.io/53_js_workshop/slides.html](http://gaslight.github.io/53_js_workshop/slides.html)

## Code
### [http://github.com/gaslight/53_js_workshop](http://github.com/gaslight/53_js_workshop)

---
class: center, middle

# Why should I care about javascript?

---
# How we used to do it

![Old web app arch](old_web_apps.png)

### Page loads every request
### Client is pretty dumb
### All the action is on the server side
---
# Where we're headed

![New web app arch](new_web_apps.png)

### Client is running the application
### Server is an api
---

class: center, middle, inverse

# A brief history of Javascript

---
template: default
layout: true

### History

---
# Early days
  * First appeared in 1995
  * Created by Brendan Eich
  * Java's "little brother"
  * Submitted to ECMA in 1996
  * ECMAScript 3 in 1999
---
# The stall...
  * IE won
  * ECMAScript 4 politics
---
# The rejuvenation
  * AJAX (2005)
  * ECMAScript 5
  * V8 and friends
  * Node.js
---
name: default
layout: true
task: &nbsp;

.task[{{task}}]

---
class: center, middle, inverse

# Syntax

???

Objekter, arrays og typer
---
template: default
layout: true

### Syntax

---

# Names
a letter optionally followed by one or more letters, digits, or underbars

## Anything but
else enum export extends
false final finally float for function
goto
if implements import in instanceof int interface
long
native new null
package private protected public
return
short static super switch synchronized
this throw throws transient true try typeof
var volatile void
while with

---

# Comments

    // a single line

    /*
      Multiple
      lines
    */

---

# Variables

    var foo =  "bar";

scoped to the current function.

    baz = "bar";

Global! GAH!

---
layout: false
class: center, middle
# Our first lab!
## [http://gaslight.github.io/53_js_workshop](http://gaslight.github.io/53_js_workshop)
## Choose Hello Javascript
---
template: default
layout: true

### Syntax

---
## typeof

An operator which return the elemental type of its argument

## Elemental types

    typeof 1;             // 'number'
    typeof '';            // 'string'
    typeof true;          // 'boolean'
    typeof {};            // 'object'
    typeof function() {}  // 'function'

### Most things are actually objects

    typeof [];          // 'object'
    typeof null;        // 'object'
    typeof /^[A-Z]/     // 'object'
    typeof new Date;    // 'object'

## Some special things
    undefined
    null
    NaN // Does not equal itself
---
## Dynamically typed (not static)
    var x = 1;
    x = "seven";

## Weakly typed (not strong)
    var product = "2" * 25; // product is 50

---
# Objects

### a set of comma separated key value pairs surrounded by curly braces
    var obj = {
      foo: "bar",
      bing: 4,
    };

### keys can be strings
### legal javascript names do not need quotes
    var obj2 = {
      legal_name: "value",
      "non-legal-name": "other_value"
    };
---

# Working with objects

## Two ways to retrieve

    var obj2 = {
      legal_name: "value",
      "non-legal-name": "other_value"
    };

    obj2.legal_name         // "value"
    obj2["non-legal-name"]  // "other_value"
    obj2["legal_name"]      // "value"

---

# Updating objects

    var object = {
      foo: bar
    };

    object.foo = "baz";
    object.bing = "wuzza";
    object["new property"] = "foo";
### Removing a property
    delete object.foo
### All properties are public all the time :(
---
layout: false
class: center, inverse, middle
# Let's make an object!
---

# Functions

    function doSomething() {
      console.log("doing something");
    }

### the name is optional
### and they can be assigned to variables
    var foo = function() {
      console.log("foo!");
    }

    doSomething();  // outputs "doing something"
    foo();          // outputs "foo!"
---
## Functions with arguments and return values

    function sum(a, b, c) {
      return a + b + c;
    }

    function saySomething(greetee) {
      console.log("Hi, " + greetee);
    }

    console.log(sum(1, 2, 3));   // outputs 6

## functions always return something
    x = saySomething("World");   // outputs "Hi, World"
    console.log(x);              // outputs undefined

---
# Functions can be arguments, too!

    function doSomething(something) {
      something();
    }

    doSomething(function() {
      console.log("I'm doing something!");
    });

    // Outputs "I'm doing something!"
---
layout: false
class: center, middle
# Let's make a function
---
# Conditionals

    if (something) {
      alert("something!");
    } else {
      alert("or not!");
    }

    switch(thing) {
      case "stuff":
        alert("thing is stuff");
        break;
      case "not stuff":
        alert("thing is not stuff");
        break;
      default:
        alert("I give up");
    }

---

# Truthiness

## These are falsy:
### false
### null
### undefined
### ""
### 0
### Nan

## Everything else is truthy
## Including "false"!
---
# Comparison
### `==` compares two things and implicitly converts them
    "5" == 5      // true
### `===` compares without type coercion
    "5" === 5     // false
### Prefer `===` and `!==`
---
class: center, middle
# Decisions, decisions
---
# Operators
<table class="operators">
  <thead>
    <tr>
      <td class="header">Operators</td>
      <td class="header">Type</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>. [] ()</td>
      <td>Refinement and invocation</td>
    </tr>
    <tr>
      <td>delete new typeof + - !</td>
      <td>Unary</td>
    </tr>
    <tr>
      <td>* / %</td>
      <td>Multiplication, division, modulo</td>
    </tr>
    <tr>
      <td>>= <= > <</td>
      <td>Inequality</td>
    </tr>
    <tr>
      <td>=== !==</td>
      <td>Equality</td>
    </tr>
    <tr>
      <td>&& ||</td>
      <td>Logical operators</td>
    </tr>
    <tr>
      <td>?:</td>
      <td>Ternary</td>
    </tr>
  </tbody>
</table>

---
# Meet array
    var array = [1, 2, 3, 4];

    array[1]          // 2
    array[100]        // undefined
    array.length      // 5
    array[4] = 5;     // array is now [1, 2, 3, 4, 5];

## You can put in anything you want
### not limited by type
    array[2] = "elephant";  // array is now [1, 2, "elephant", 4, 5];

---

## It's a lying liar who lies
    var array = [1, 2, 3, 4, 5];
    typeof(array)         // object
    array[1000] = "foo";
    array.length          // 1001

---
# Looping with for

    for (var i=0; i < 10; i++) {
      console.log(i);
    }

## Iterating over an array
    var stuff = [1, 2, 3, 4, 5];
    for (var i=0; i < stuff.length; i++) {
      console.log(stuff[i]);
    }

---
class: center, middle
# Let's have some fun with arrays

---
## Iterating over an object with for.. in

    var object = {foo: "bar", bing: "baz"};
    for (var key in object) {
      console.log(key);
      console.log(object[key]);
    }
---
class: center, middle
# Iterating over objects

---
# Simple looping with do and while

    var condition = true;
    while(condition) {
      console.log("seems true so far");
      condition = false;
    }

    var otherCondition = false;
    do {
      console.log("doing this at least once");
    } while(otherCondition);

---

# More about objects

## Objects can contain other objects

    object = {
      foo: "bar"
      baz: {
        bing: 3
      }
    }

    object.baz.foo    // 3

### but be careful
    object.wuzza.foo  // causes a ReferenceError!
### so safety first
    object.wuzza && object.wuzza.foo  // returns undefined
---
# Methods
## Objects can also contain functions
### Methods get a reference to the object they are a property of called `this`
### It is not implicit!
    var object = {
      foo: "bar",
      accessor: function() {
        return this.foo;
      }
      badAccessor: function() {
        return foo;
      }
    }

    object.accessor()     // "bar"
    object.badAccessor()  // undefined
---
# Methods
## This is dynamic
### Bound when the method is invoked

    var method = function() {
      return this.foo;
    };

    var object = { foo: "bar" };

    object.accessor = method;

    object.accessor()     // "foo"
---
# Higher order functions
## Functions can return functions

    function makeAdder(num) {
      return function(addend) {
        return num + addend;
      }
    }

    var twoAdder = makeAdder(2);
    twoAdder(3);      // 5
---
class: center, middle

# Higher order functions
---
# Scope and Closure
### functions have access to the parameters and variables of the function they are defined in
### This is true even after the defining function is no longer executing

    var outerFunction() {
      var three = 3;
      return function giveMeAThree() {
        return three;
      }
    }
---
# Simulating privacy
## You can use these facts to roll your own encapsulation

    function buildSequence() {
      var seq = 0;
      return {
        increment: function() {
          seq++;
        },
        currentValue: function() {
          return seq;
        }
      }
    }

    var sequence = buildSequence();
    sequence.increment();
    sequence.increment();
    sequence.currentValue();    // 2
---
class: center, middle
# Binding scope
---
# Apply/call invocation

Applying functions to objects.

    function doStuff () {
      return this.speed;
    }

    var obj = { speed: 2 };

    doStuff.apply(obj, [ arg1, arg2 ]);  // 2

    doStuff.call(obj, arg1, arg2);     // 2

---
# Constructor functions
## are plain ole functions invoked with new
## by convention they start with a capital letter
## get a new object set to this
## which is implicitly returned
---
# Our first constructor

    function Cat(name) {
      this.name = name;
    }

    muffin = new Cat("muffin");
    tiger = new Cat("tiger");
    muffin.name       // "muffin"
    tiger.name        // "tiger"
### Sometimes called "class" functions
---
class: center, middle
# Let's construct some objects!
---
# Introducing the prototype
### All objects have one
### It's not easily accessible
### When accessing a property, if not found the prototype is searched
### prototypes can have prototypes
---
# Constructors and prototypes
### function objects have a prototype property
### prototype is what `this` is set to when invoked with new
    function Cat(name) {
      this.name = name;
    }

    Cat.prototype.lives = 9;

    felix = new Cat("Felix");
    felix.lives         // 9

### you can 'shadow' properties
    felix.lives = 10
    garfield = new Cat("Garfield");
    felix.lives         // 10
    garfield.lives      // 9
---
# Super secret knowledge you should never use
### An object's prototype is not accessible
### But there is a super secret `__proto__` property
### Not part of any spec, but all browsers implement it
### In ES5 we have Object.getPrototypeOf()
### and Object.create(prototype)
---
class: center, middle
# Let's do some Inheritance labs1

---
# arguments
### You can pass as many or as few arguments to functions as you want
### Unset arguments are `undefined`
### `arguments` let's you access an "array" of your functions arguments
    function logArguments() {
      var i;
      for(i =0 ; i < arguments.length; i++)
      {
        console.log(arguments[i]);
      }
    }
---
class: center, inverse, middle
# Meet Codio
---
## Go to codio.com
## Sign up!
## Go to https://codio.com/superchris/53-js-workshop
## Fork this project (Project|Fork)
---
# Meet [jasmine](http://pivotal.github.io/jasmine/)
## TDD for javascript
## Behavior Driven Development
## Runs in the browser or on the console
---
# Jasmine basics
## `describe` contains a suite
## `it` creates a spec
## `expect` expectation
---
class: center, middle, inverse
# Lab1
---
# End of Day 1
---
name: jquery_start
# jQuery
### "a fast, small, and feature-rich JavaScript library"
## Nice abstractions over:
### DOM traversal and manipulation
### Event handling
### AJAX
---
# $
## By default, jQuery is accessible as $
### jQuery.noConflict() can help if this is a problem
---
# ready
### You generally always want to execute jQuery calls when the DOM is loaded
### ready() is your "hook" to do this

    $(document).ready(function() {
      // your code here
    });

### short form
    $(function() {
      // less typing is good.
    });
---
# Selection
## Call $ with any css selector
    $("h2");      // returns all h2 nodes
    $("#main");   // returns element(s) with id="main"
    $(".happy");  // returns all elements with class="happy"
    $(".happy .sad")  // returns any descendants of .happy that are .sad
    $(".happy  > .sad")  // returns any directh children of .happy that are .sad
    $(".happy:first")    // the first .happy

### Returns all the matching elements
### But you can get what you need...
    $("h2").first();
    $("h2").eq(index);
    $("h2:first");
    $("h2").last();
---
# $ methods
### Most jQuery methods are both getters and setters
### To set, pass an argument
    var text = $("h1").text();
    $("h1").text("The new text");
---
# Other methods that work this way
### `html()`
### `attr()`
### `width()`
### `height()`
### `val()`
---
class: center, middle
# try.jquery.com
# sections 1.4 - 1.7, 1.11 - 1.13
---
class: center, middle

# Really end Day 1

---
name: jquery_start
# jQuery
### "a fast, small, and feature-rich JavaScript library"
## Nice abstractions over:
### DOM traversal and manipulation
### Event handling
### AJAX
---
# $
## By default, jQuery is accessible as $
### jQuery.noConflict() can help if this is a problem
---
# ready
### You generally always want to execute jQuery calls when the DOM is loaded
### ready() is your "hook" to do this

    $(document).ready(function() {
      // your code here
    });

### short form
    $(function() {
      // less typing is good.
    });
---
# Selection
## Call $ with any css selector
    $("h2");      // returns all h2 nodes
    $("#main");   // returns element(s) with id="main"
    $(".happy");  // returns all elements with class="happy"
    $(".happy .sad")  // returns any descendants of .happy that are .sad
    $(".happy  > .sad")  // returns any directh children of .happy that are .sad
    $(".happy:first")    // the first .happy

### Returns all the matching elements
### But you can get what you need...
    $("h2").first();
    $("h2").eq(index);
    $("h2:first");
    $("h2").last();
---
# $ methods
### Most jQuery methods are both getters and setters
### To set, pass an argument
    var text = $("h1").text();
    $("h1").text("The new text");
---
# Other methods that work this way
### `html()`
### `attr()`
### `width()`
### `height()`
### `val()`
---
class: center, middle
# try.jquery.com
# sections 1.4 - 1.7, 1.11 - 1.13
---
name: start_day2
# jQuery manipulation
### Creating new elements
    var elem = $("<div>here is something</div>");

### Adding them to the DOM

    elem.appendTo($("#main"));

### or

    $("#main").append(elem);

### Also:
### prepend/prependTo
### after/insertAfter
### before/insertBefore
---
# More goodness

### Showing and hiding
    $(".thing").hide();
    $(".thing").show();

### Add/remove css classes
    $(".thing").addClass("red");
    $(".thing").removeClass("red");
---
# Traversing
### Finding other elements relative to a selector
    $(".foo").children();   // direct children
    $(".foo").parents();    // any ancestors
    $(".foo").parent();     // just Mom (or Dad)
    $(".foo").siblings();   // any siblings

### They can be refined via a selector
    $(".foo").parents("div");

### Also
    $(".foo").closest()
    $(".foo").find("li")    // Any descendants who are li

---
# Events

### you can select by attribute, too
    $("button").on("click", function(event) {
      // do something important
    });

### shorthand
    $("button").click(function() {});

### blur, click, dblClick, change, focusin/focusout, keydown/keyup, mousedown/mouseup, mouseenter/mouseleave
---
# event object properties
### target - the node that triggered
### type - what kind of event
### which - specific key or button that was pressed
### preventDefault() - call to prevent default behavior (loading new page)
### stopPropagation() - don't bubble up
---
# Try, throw catch

tr
---
layout: false
class: center, middle, inverse

# Object Literals

???

Objekter, arrays og typer
---
template: default
layout: true

### Object Literals
---
task: [#01 Object properties](http://js-workshop.herokuapp.com/#1/1)

# Objects

A collection of key-value properties.

    var obj = {
      key1: 'value1',
      key2: 13
    };

    obj.key1;         // 'value1'
    obj['key2'];      // 13
    obj.key3;         // undefined

    delete obj.key1;
    obj.key1;         // undefined

???

- Aksess av felter både ved . og []
- Manglende felt gir undefined, ikke feil

---
task: [#02 Populating arrays](http://js-workshop.herokuapp.com/#1/2)

# Arrays

A collection of indexed properties.

    var arr = [1, "two", 3];

    arr.push(4);

    arr[1];         // "two"
    arr[3] = 4;
    arr.length;     // 4

???

- Dynamisk størrelse
- Vilkårlige typer objekter
- .length

---

# Objects vs. Arrays (1/2)

Arrays are not "real":

- Objects in disguise
- Operations are slow when number of elements are large


    var obj = [1, 2, 3];
    obj.speed = 5;

    obj[1];         // 2
    obj.speed       // 5
    obj['speed'];   // 5

    obj.length;     // 3

???

.length baserer seg på "array" innhold, ikke andre felter

---
task: [#03 What have you got?](http://js-workshop.herokuapp.com/#1/3)

# Objects vs. Arrays (2/2)

The `for (... in ...)` loops all properties of an object.

    var obj = [1, 2, 3];
    obj.speed = 5;

    var i;
    for (i = 0; i < obj.length; ++i) {
      obj[i];  // 1, 2, 3
    }

    var key;
    for (key in obj) {
      obj[key];  // 1, 2, 3, 5
    }

---
task: [#04 Who are you?](http://js-workshop.herokuapp.com/#1/4)

# Types

Go figure.

    new Object();       // {}
    new Array();        // []
    new Number(1);      // 1
    new Boolean(true);  // true

    typeof {};          // 'object'
    typeof [];          // 'object'     WTF?
    typeof 1;           // 'number'
    typeof '';          // 'string'
    typeof true;        // 'boolean'

    typeof null;        // 'object'     WTF?

???

- Foretrukket å ikke bruke new (kan utelates og gi feil resultat)
- typeof [] gir mening, men kan ikke skille typene
- typeof gir alltid streng
- typeof må brukes for å sjekke eksistens (men ikke for objektfelter)

---
layout: false
class: center, middle, inverse

# Functions

---
template: default
layout: true

### Functions
---

# You name it

    function () {}

    function add (a, b) {
      return a + b;
    }

    var multiply = function (a, b) {
      return a * b;
    };

    var recur = function rec (num) {
      if (num === 0) { return num; }
      return rec(num - 1);
    };

???

- Function expressions vs statements
- Hoisting - add tilgjengelig overalt
- Kan lagre (anonyme) funksjoner i variabler
- Navngitt funksjon privat ved tilordning (recur / rec)

---
task: [#01 How many arguments do you have?](http://js-workshop.herokuapp.com/#2/1)

# arguments

All functions can access their:

- `arguments`
  - `length`
  - `callee`


    function countArgs () {
      return arguments.length;
    }

    countArgs();              // 0
    countArgs('one');         // 1
    countArgs('one', 'two');  // 2

???

- arguments ikke array, men objekt med length-felt
- callee - funksjonen selv, den som blir kalt
- Oppgave løses med for, ikke for in
- Siste definisjon av funksjon med samme navn gjelder
- Funksjon kan kalles med vilkårlig antall argumenter uavh. av definisjon

---
task: [#02 Higher order functions](http://js-workshop.herokuapp.com/#2/2)

# First order variables

- Functions can return functions
- Functions can take functions as an argument


    function createFunction () {
      return function () {

      };
    }

    var anonymous = createFunction();
    anonymous();  // undefined

---

# Scope (1/2)

JavaScript has __function scope__, not block scope.

    function () {
      i;  // undefined    WTF?

      for (var i = 0; i < 10; i++) {

      }

      i;  // 10
    }

???

Uten var i hadde man fått ReferenceError

---

# Scope (2/2)

Variable declarations towards the top, please!

    function () {
      var i;

      for (i = 0; i < 10; i++) {

      }

      i;  // 10
    }

???

Hoisting - skjer implisitt, så greit å gjøre synlig

---

# More on scope (1/3)

Functions can access everything from their outer scope.

    var a = 1;

    function doSomething () {
      a;  // 1

      function doMore () {
        a;  // 1
      }
    }

---

# More on scope (2/3)

Not the other way around.

    function doSomething () {
      var b = 1;

      function doMore () {
        b;  // 1
      }
    }
    doSomething();

    b;  // ReferenceError

???

Funksjon kan kjøres når expression - vanlig med () rundt for å gjøre til expr.

---
task: [#03 JavaScript pwns your scope](http://js-workshop.herokuapp.com/#2/3)

# More on scope (3/3)

Forgot the __`var`__? You've got yourself a global!

    function doSomething () {
      c = 1;

      function doMore () {
        c;  // 1
      }
    }
    doSomething();

    c;  // 1

---
task: [#04 Variables by reference](http://js-workshop.herokuapp.com/#2/4)<br /> [#05 Binding scope](http://js-workshop.herokuapp.com/#2/5)

# Closures (1/3)

Functions can bind scope, even after their outer function has returned!

    var counter = function () {
      var i = 0;

      return function () {
        return i++;
      };
    };

    var inc = counter();
    inc();  // 0
    inc();  // 1

---
task: [#06 Globally ugly, privately slow, closingly sweet](http://js-workshop.herokuapp.com/#2/6)<br />[#07 Variables by reference](http://js-workshop.herokuapp.com/#2/7)

# Closures (2/3)

Functions can run immediatly!

    var inc = function () {
      var i = 0;

      return function () {
        return i++;
      };
    }();  // Note the trailing ()!

    inc();  // 0
    inc();  // 1

---

# Closures (3/3)

Create modules with private state!

    var lib = {};
    lib.module = (function () {

      var privateVariable;

      var privateFunction = function () {};

      return {
        publicProperty: 1,
        privilegedMethod: function (arg) {
          // privateVariable = arg;
        }
      };

    })();

---

# Context

- Functions run in different contexts
  - Depending on how they are invoked

- May be invoked in 4 primary ways
  - Function invocation
  - Constructor invocation
  - Method invocation
  - `apply`/`call` invocation

---
task: [#08 What is this?](http://js-workshop.herokuapp.com/#2/8)

# Function invocation

Functions called directly.

    var countArgs = function () {
      // this === window

      return arguments.length;
    };

    countArgs();  // 0

???

I nodejs ville this ikke være window, men exports.

---
task: [#09 Constructing objects](http://js-workshop.herokuapp.com/#2/9)

# Constructor invocation (1/2)

Functions called with the __`new`__ keyword.

    function Person (name) {
      // this === instance of Person

      this.name = name;
    }

    var bob = new Person('bob');
    var ed = new Person('ed');

    ed.name = 'fred';

---

# Constructor invocation (2/2)

But there's a gotcha!

    function Person (name) {
      this.name = name;
    }

    var bob = Person('bob');
    var ed = new Person('ed');

    window.name === 'bob'  // true    WTF?

---
task: [#10 Context confusion](http://js-workshop.herokuapp.com/#2/10)

# Method invocation

Functions called on objects.

    var obj = {
      value: 1,
      getValue: function () {
        // this === obj

        return this.value;
      }
    };

    obj.getValue()  // 1

---
task: [#11 Is this yours?](http://js-workshop.herokuapp.com/#2/11)

#  apply/call invocation

Applying functions to objects.

    function doStuff () {
      return this.speed;
    }

    var obj = { speed: 2 };

    doStuff.apply(obj, [ arg1, arg2 ]);  // 2

    doStuff.call(obj, arg1, arg2);     // 2

---
layout: false
class: center, middle, inverse

# Inheritance

---
layout: true
template: default

### Inheritance
---

# Multiple paradigms

- Pseudoclassical inheritance

- Prototypal/differential inheritance

- Functional inheritance

???

- Ullent område
- Mange gjør forskjellig
- Prøver å etterligne andre språk
- JavaScript kan tilpasses flere paradigmer

---

# Prototype (1/3)

- Inherit directly from other objects
  - Properties
  - Methods

- All objects inherit from a `prototype` property

- Bound upon object creation


    var obj = {};
    obj.toString();  // '[object Object]'

---

# Prototype (2/3)

The `prototype` property.

    function Object () {}

    Object.prototype = {
      toString: function () {
        return '[object Object]';
      }
    };

    var obj = new Object();
    obj.toString();  // '[object Object]'

---

# Prototype (3/3)

    var first = new Object();
    // first.__proto__ = Object.prototype;

    first.x = 1;       // on first
    first.toString();  // on first's prototype (Object)

![Prototypal Inheritance 1](prototype1.png)

---
task: [#01 Pseudoclassical 1](http://js-workshop.herokuapp.com/#3/1)

# Pseudoclassical inheritance (1/2)

.right.pushdown[![Prototypal Inheritance 2](prototype2.png)]

    function CoolObject (x) {
      this.x = x;
    }

    CoolObject.prototype = {
      getX : function () {
        return this.x;
      }
    };

    var coolObj = new CoolObject(1);

???

- Prototype-objektet deles av alle instanser, hvert objekt arver ikke alt
- Minner om statiske klassevariabler/metoder
- Kan endre ting på prototypen i etterkant - vil påvirke alle instanser
- Kan endre prototype for objekt etter opprettelse
- Husk at = { .. tilsvarere new Object()

---
task: [#02 Pseudoclassical 2](http://js-workshop.herokuapp.com/#3/2)

# Pseudoclassical inheritance (2/2)

- Intented to look object oriented - looks quite alien?

- Remember to use __`new`__!
 - Clobbering global variables
 - No compile warning, no runtime warning
 - Convention - all constructor functions start with an capital letter

"_Comfort to unexperienced JavaScript programmers_"
"_Induce unnecessary complex hierarcies_"
"_... motivated by constraints of static type checking_"

__JavaScript has more and better options__

???

- Bedre å pakke inn new for å unngå å etterligne andre språk
- Veldig likt obj := Object clone i Io

---
task: [#03 Prototypal](http://js-workshop.herokuapp.com/#3/3)

# Prototypal/differential inheritance

- Dispence with classes, make useful objects
- Specify differences


    function create (proto) {
      function F () {};
      F.prototype = proto;
      return new F();
    }

    var eventBase = {
      emit: function () {},
      on: function () {}
    };

    var obj = create(eventBase);
    obj.emit('some event');

---
task: [#04 Functional](http://js-workshop.herokuapp.com/#3/4)

# Functional inheritance (1/2)

    var person = function (options) {
      var that = {};

      that.getName = function () {
        return options.name;
      };

      return that;
    };

    var bob = person({ name: 'bob' });
    var ed = person({ name: 'ed' });

???

Ulempe at alle instanser får egne kopier av funksjoner

---

# Functional inheritance (2/2)

    function Car (options) {

      this.getColor = function () {
        return options.color;
      };
    }

    Car.proto...

    var car = new Car({ color: 'red' });
    car.getColor(); // 'red'

---
layout: false
class: center, middle, inverse

# Bad Parts

---
layout: true
template: default

### Bad Parts
---

# Arrays

Indices are free to go.

    var arr = [1, 2, 3];
    arr[999] = 0; // WTF
    arr.length;   // 1000

    delete arr[1];
    arr; // [1, undefined, 3];

???

Sletting må gjøres med splice(1,1) (fjern ett element fra posisjon 1)

---

# for (... in ...)

Properties from the `prototype` chain are looped as well.

    var key;

    for (key in obj) {
      if (obj.hasOwnProperty(key)) {
        // Property belongs to obj itself
      }
    }

---

# eval is evil

Property look-ups.

    // Don't do
    eval('var value = obj.' + key);

    // Rather do
    var value = obj[key];

Function references.

    // Don't do
    var f = new Function("alert('hello');");
    setTimeout("alert('hello')", 1000);
    setInterval("alert('hello')", 1000);

    // Rather do
    var f = function () { alert('hello'); };
    setTimeout(f, 1000);

---

# Falsy values

- __`false`__
- __`null`__
- __`undefined`__
- `0` (zero)
- `''` or `""` (empty string)
- __`NaN`__ (not-a-number, e.g. 'a' / 2)


`&&` and `||` return the actual value of the expession that stops the evaluation:


    function Car (name) {
      this.name = name || 'default name';
    }

---

# Transitivity - come again?

    0 == '0'            // true
    0 == ''             // true
    '' == '0'           // false

    false == 'false'    // false
    false == '0'        // true

    undefined == false  // false
    undefined == true   // false
    false == null       // false
    null == undefined   // true

    ' \t\r\n ' == 0     // true

---

# Semicolon insertion (1/2)

    function getStatus () {
      return
      {
        status: true
      }
    }

---

# Semicolon insertion (2/2)

    function getStatus () {
      return;                             <- semicolon insertion
      {                                   <- open block
        status: true                      <- loop label
      }                                   <- close block
    }


# W T F

---

# arguments is not an array

It only pretends to be.

    {
      '0': 1,
      '1': 2,
      length: 2
    }

But you can fix it.

    function f () {
      var slice = Array.prototype.slice; // [].slice
      return slice.apply(arguments);
    }

    f(1, 2);  // [1, 2]

---

# Keywords

    obj[&lt;keyword&gt;] = 1  // Reserved word (undefined, NaN, Infinity?)

- `abstract`
- __`boolean`__ __`break`__ `byte`
- __`case`__ __`catch`__ `char` `class` `const` __`continue`__
- __`debugger`__ __`default`__ __`delete`__ `do` `double`
- __`else`__ `enum` `export` `extends`
- __`false`__ `final` __`finally`__ `float` __`for`__ __`function`__
- `goto`
- __`if`__ `implements` `import` __`in`__ __`instanceof`__ `int` `interface`
- `long`
- `native` __`new`__ __`null`__
- `package` `private` `protected` `public`
- __`return`__
- `short` `static` `super` __`switch`__ `synchronized`
- __`this`__ __`throw`__ `throws` `transient` __`true`__ __`try`__ __`typeof`__
- __`var`__ `volatile` __`void`__
- __`while`__ __`with`__

---

# Avoid void

Void is not useful, avoid void!

- __`void`__ is an operator
- takes an operand
- returns __`undefined`__

` `

    void 1  // undefined

---
layout: false
class: center, middle, inverse

# That's all folks!

Slideshow created with [remark](http://gnab.github.com/remark).

    </textarea>
    <script>
      var slideshow = remark.create({ highlightLanguage: 'javascript'});
    </script>
  </body>
</html>
